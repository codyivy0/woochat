# Kafka Dockerfile for Railway deployment
FROM confluentinc/cp-kafka:7.5.0

# Set environment variables for single-node Kafka
ENV KAFKA_NODE_ID=1
ENV KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
ENV KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
ENV KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
ENV KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1
ENV KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
ENV KAFKA_PROCESS_ROLES=broker,controller
ENV KAFKA_CONTROLLER_QUORUM_VOTERS=1@localhost:29093
ENV KAFKA_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:29093,EXTERNAL://:9094
ENV KAFKA_INTER_BROKER_LISTENER_NAME=PLAINTEXT
ENV KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
ENV KAFKA_LOG_DIRS=/tmp/kraft-combined-logs
ENV CLUSTER_ID=MkU3OEVBNTcwNTJENDM2Qk

# Railway will set this automatically
ENV KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092,EXTERNAL://0.0.0.0:9094

# Expose the ports
EXPOSE 9092 9094

# Create the log directory
RUN mkdir -p /tmp/kraft-combined-logs

# Start Kafka
CMD ["kafka-server-start", "/etc/kafka/server.properties"]